<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: models/device.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: models/device.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
/**
 * @module resin/models/device
 */

(function() {
  var DEVICES, errors, pine, server, settings, _;

  pine = require('../pine');

  _ = require('lodash-contrib');

  errors = require('../errors');

  server = require('../server');

  settings = require('../settings');

  DEVICES = require('./device-data.json');


  /**
   * A Resin API device
   * @typedef {Object} Device
   */


  /**
   * getAll callback
   * @callback module:resin/models/device~getAllCallback
   * @param {(Error|null)} error - error
   * @param {Device[]} devices - devices
   */


  /**
   * @summary Get all devices
   * @public
   * @function
   *
   * @param {module:resin/models/device~getAllCallback} callback - callback(error, devices)
   *
   * @example
   *	resin.models.devices.getAll (error, devices) ->
   *		throw error if error?
   *		console.log(devices)
   */

  exports.getAll = function(callback) {
    return pine.get({
      resource: 'device',
      options: {
        expand: 'application',
        orderby: 'name asc'
      }
    }).then(function(devices) {
      if (_.isEmpty(devices)) {
        return callback(new errors.NotAny('devices'));
      }
      return callback(null, devices);
    })["catch"](function(error) {
      return callback(error);
    });
  };


  /**
   * getAllByApplication callback
   * @callback module:resin/models/device~getAllByApplicationCallback
   * @param {(Error|null)} error - error
   * @param {Device[]} devices - devices
   */


  /**
   * @summary Get all devices by application
   * @public
   * @function
   *
   * @param {(String|Number)} applicationId - application id
   * @param {module:resin/models/device~getAllByApplicationCallback} callback - callback
   *
   * @example
   *	resin.models.devices.getAllByApplication (error, devices) ->
   *		throw error if error?
   *		console.log(devices)
   */

  exports.getAllByApplication = function(applicationId, callback) {
    return pine.get({
      resource: 'device',
      options: {
        filter: {
          application: applicationId
        },
        expand: 'application',
        orderby: 'name asc'
      }
    }).then(function(devices) {
      if (_.isEmpty(devices)) {
        return callback(new errors.NotAny('devices'));
      }
      devices = _.map(devices, function(device) {
        device.application_name = device.application[0].app_name;
        device.device_display_name = exports.getDisplayName(device.device_type);
        return device;
      });
      return callback(null, devices);
    })["catch"](function(error) {
      return callback(error);
    });
  };


  /**
   * get callback
   * @callback module:resin/models/device~getCallback
   * @param {(Error|null)} error - error
   * @param {Device} device - device
   */


  /**
   * @summary Get a single device
   * @public
   * @function
   *
   * @param {(String|Number)} id - device id
   * @param {module:resin/models/device~getCallback} callback - callback
   *
   * @example
   *	resin.models.device.get 51, (error, device) ->
   *		throw error if error?
   *		console.log(device)
   */

  exports.get = function(deviceId, callback) {
    return pine.get({
      resource: 'device',
      id: deviceId,
      options: {
        expand: 'application'
      }
    }).then(function(device) {
      if (device == null) {
        return callback(new errors.NotFound("device " + id));
      }
      device.application_name = device.application[0].app_name;
      device.device_display_name = exports.getDisplayName(device.device_type);
      return callback(null, device);
    })["catch"](function(error) {
      return callback(error);
    });
  };


  /**
   * remove callback
   * @callback module:resin/models/device~removeCallback
   * @param {(Error|null)} error - error
   */


  /**
   * @summary Remove device
   * @public
   * @function
   *
   * @param {(String|Number)} id - device id
   * @param {module:resin/models/device~removeCallback} callback - callback
   *
   * @example
   *	resin.models.device.remove 51, (error) ->
   *		throw error if error?
   */

  exports.remove = function(id, callback) {
    return pine["delete"]({
      resource: 'device',
      id: id
    }).then(function() {
      return callback();
    })["catch"](function(error) {
      return callback(error);
    });
  };


  /**
   * identify callback
   * @callback module:resin/models/device~identifyCallback
   * @param {(Error|null)} error - error
   */


  /**
   * @summary Identify device
   * @public
   * @function
   *
   * @param {String} uuid - device uuid
   * @param {module:resin/models/device~identifyCallback} callback - callback
   *
   * @example
   *	resin.models.device.identify '23c73a12e3527df55c60b9ce647640c1b7da1b32d71e6a21369ac0f00db828', (error) ->
   *		throw error if error?
   */

  exports.identify = function(uuid, callback) {
    return server.post(settings.get('urls.identify'), {
      uuid: uuid
    }, _.unary(callback));
  };


  /**
   * rename callback
   * @callback module:resin/models/device~renameCallback
   * @param {(Error|null)} error - error
   */


  /**
   * @summary Rename device
   * @public
   * @function
   *
   * @param {(String|Number)} id - device id
   * @param {String} name - the device new name
   * @param {module:resin/models/device~renameCallback} callback - callback
   *
   * @todo This action doesn't return any error
   * if trying to rename a device that does not
   * exists. This should be fixed server side.
   *
   * @example
   *	resin.models.device.rename 317, 'NewName', (error) ->
   *		throw error if error?
   *		console.log("Device has been renamed!")
   */

  exports.rename = function(id, name, callback) {
    return pine.patch({
      resource: 'device',
      id: id,
      data: {
        name: name
      }
    }).then(function() {
      return callback();
    })["catch"](function(error) {
      return callback(error);
    });
  };


  /**
   * note callback
   * @callback module:resin/models/device~noteCallback
   * @param {(Error|null)} error - error
   */


  /**
   * @summary Note a device
   * @public
   * @function
   *
   * @param {(String|Number)} id - device id
   * @param {String} note - the note
   * @param {module:resin/models/device~noteCallback} callback - callback
   *
   * @example
   *	resin.models.device.note 317, 'My useful note', (error) ->
   *		throw error if error?
   *		console.log("Device has been noted!")
   */

  exports.note = function(id, note, callback) {
    return pine.patch({
      resource: 'device',
      id: id,
      data: {
        note: note
      }
    }).then(function() {
      return callback();
    })["catch"](function(error) {
      return callback(error);
    });
  };


  /**
   * @summary Get display name for a device
   * @public
   * @function
   *
   * @see {@link module:resin/models/device.getSupportedDeviceTypes} for a list of supported devices
   *
   * @param {String} device - device name
   * @returns {String} device display name or 'Unknown'
   *
   * @example
   *	console.log resin.models.device.getDisplayName('raspberry-pi') # Raspberry Pi
   *	console.log resin.models.device.getDisplayName('rpi') # Raspberry Pi
   */

  exports.getDisplayName = function(device) {
    var key, value;
    if (_.indexOf(exports.getSupportedDeviceTypes(), device) !== -1) {
      return device;
    }
    for (key in DEVICES) {
      value = DEVICES[key];
      if (_.indexOf(value.names, device) !== -1) {
        return key;
      }
    }
    return 'Unknown';
  };


  /**
   * @summary Get device slug
   * @public
   * @function
   *
   * @param {String} device - device name
   * @returns {String} device slug or 'unknown'
   *
   * @example
   *	console.log resin.models.device.getDeviceSlug('Raspberry Pi') # raspberry-pi
   */

  exports.getDeviceSlug = function(device) {
    var displayName, _ref;
    displayName = exports.getDisplayName(device);
    return ((_ref = DEVICES[displayName]) != null ? _ref.slug : void 0) || 'unknown';
  };


  /**
   * @summary Get a list of supported device types
   * @public
   * @function
   *
   * @returns {String[]} a list of all supported devices, by their display names
   *
   * @example
   *	devices = resin.models.device.getSupportedDevicesTypes()
   *	console.log(devices)
   */

  exports.getSupportedDeviceTypes = function() {
    return _.keys(DEVICES);
  };

}).call(this);
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="auth.html">resin/auth</a></li><li><a href="connection.html">resin/connection</a></li><li><a href="data.html">resin/data</a></li><li><a href="prefix.html">resin/data/prefix</a></li><li><a href="logs.html">resin/logs</a></li><li><a href="application.html">resin/models/application</a></li><li><a href="device.html">resin/models/device</a></li><li><a href="environment-variables.html">resin/models/environment-variables</a></li><li><a href="key.html">resin/models/key</a></li><li><a href="os.html">resin/models/os</a></li><li><a href="server.html">resin/server</a></li><li><a href="settings.html">resin/settings</a></li><li><a href="vcs.html">resin/vcs</a></li></ul><h3>Classes</h3><ul><li><a href="connection.ConnectionParams.html">ConnectionParams</a></li></ul><h3>Namespaces</h3><ul><li><a href="resin.html">resin</a></li><li><a href="resin.html#models">models</a></li><li><a href="resin.html#settings">settings</a></li><li><a href="resin.settings.directories.html">directories</a></li><li><a href="resin.settings.events.html">events</a></li><li><a href="resin.settings.files.html">files</a></li><li><a href="resin.settings.keys.html">keys</a></li><li><a href="resin.settings.pubnub.html">pubnub</a></li><li><a href="resin.settings.urls.html">urls</a></li><li><a href="data_.html">resin/data</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a> on Fri Jan 09 2015 11:05:15 GMT-0300 (ART)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
